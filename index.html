<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Absurd Dream Slideshow</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary-purple: #8B7CF6;
      --secondary-purple: #A78BFA;
      --lilac: #C4B5FD;
      --card-bg: rgba(255, 255, 255, 0.1);
      --text-light: #F3F4F6;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text-light);
      overflow-x: hidden;
      position: relative;
    }

    /* Floating celestial elements */
    .celestial-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .moon, .star {
      position: absolute;
      border-radius: 50%;
      opacity: 0.6;
      animation: float 6s ease-in-out infinite;
    }

    .moon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #FEF3C7, #F59E0B);
      box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
    }

    .star {
      width: 8px;
      height: 8px;
      background: white;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .moon:nth-child(1) { top: 10%; right: 15%; animation-delay: -2s; }
    .moon:nth-child(2) { top: 70%; left: 10%; animation-delay: -4s; }
    .star:nth-child(3) { top: 20%; left: 20%; animation-delay: -1s; }
    .star:nth-child(4) { top: 30%; right: 30%; animation-delay: -3s; }
    .star:nth-child(5) { top: 60%; right: 20%; animation-delay: -5s; }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 30px 20px;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: clamp(24px, 4vw, 42px);
      font-weight: 700;
      background: linear-gradient(45deg, var(--primary-purple), var(--lilac));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .input-section {
      margin-bottom: 30px;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      padding: 30px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    textarea {
      width: 100%;
      min-height: 100px;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid rgba(139, 124, 246, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-light);
      font-size: 16px;
      font-family: 'Poppins', sans-serif;
      resize: vertical;
      margin-bottom: 20px;
    }

    textarea::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    button {
      padding: 15px 30px;
      border-radius: 15px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      background: linear-gradient(135deg, var(--primary-purple), var(--secondary-purple));
      color: white;
      box-shadow: 0 8px 25px rgba(139, 124, 246, 0.4);
      transition: all 0.3s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(139, 124, 246, 0.6);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Swiper */
    .slideshow-container {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px;
      margin-bottom: 30px;
    }

    .swiper {
      width: 100%;
      height: 500px;
      border-radius: 15px;
    }

    .swiper-slide {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(30, 27, 75, 0.8), rgba(91, 33, 182, 0.8));
    }

    .slide-img {
      max-width: 90%;
      max-height: 350px;
      border-radius: 15px;
      object-fit: cover;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .caption {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      padding: 15px 25px;
      border-radius: 25px;
      font-size: 16px;
      text-align: center;
      max-width: 90%;
      line-height: 1.5;
    }

    .loading {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      opacity: 0.7;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .swiper {
        height: 400px;
      }
    }
  </style>
</head>
<body>
  <!-- Floating celestial elements -->
  <div class="celestial-bg">
    <div class="moon"></div>
    <div class="moon"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
  </div>

  <div class="container">
    <header>
      <h1>âœ¨ Absurd Dream Slideshow âœ¨</h1>
      <p>Transform your daily moments into whimsical dreams</p>
    </header>

    <div class="input-section">
      <textarea id="day" placeholder="Describe your day... (e.g., I had coffee with friends, went to work, got stuck in traffic...)"></textarea>
      <button onclick="absurdify()">ðŸŒ™ Absurdify My Day</button>
    </div>

    <div class="slideshow-container">
      <div class="swiper" id="dreamSlideshow">
        <div class="swiper-wrapper" id="output">
          <div class="swiper-slide">
            <div class="empty-state">
              <div class="empty-state-icon">ðŸŒŸ</div>
              <h3>Your dreams await...</h3>
              <p>Describe your day above and watch the magic unfold</p>
            </div>
          </div>
        </div>
        <div class="swiper-pagination"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    let HUGGINGFACE_KEY = ""    
    fetch('config.json')
      .then(response => response.json())
      .then(config => {
        window.HUGGINGFACE_KEY = config.API_KEY;
        HUGGINGFACE_KEY = config.API_KEY;
      })
      .catch(error => {
        console.error('Error loading config:', error);
        alert("Failed to load configuration. Please check your API key.");
      });
    let swiper = null;

    function initSwiper() {
      if (swiper) {
        swiper.destroy(true, true);
      }
      
      swiper = new Swiper('#dreamSlideshow', {
        loop: true,
        autoplay: {
          delay: 4000,
          disableOnInteraction: false,
        },
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        effect: 'fade',
        fadeEffect: {
          crossFade: true,
        },
        speed: 800,
      });
    }

    // Absurd realistic scenario templates
    const ABSURD_SCENARIOS = {
      workplace: [
        "but your boss is actually three penguins in a business suit",
        "except the office building is made entirely of cheese",
        "while riding a unicycle through hallways filled with floating staplers"
      ],
      
      coffee: [
        "but the coffee beans are tiny singing birds",
        "except the cafe is run by philosophical cats wearing bow ties",
        "while sitting on clouds instead of chairs"
      ],
      
      traffic: [
        "but all cars are replaced by giant rolling dice",
        "except the road is made of rainbow-colored jelly",
        "while traffic lights are operated by dancing squirrels"
      ],
      
      shopping: [
        "but the shopping cart has a mind of its own and gives life advice",
        "except all products are replaced by miniature circus performers",
        "while the store aisles are actually floating in space"
      ],
      
      cooking: [
        "but the ingredients start telling jokes while you chop them",
        "except the kitchen utensils have formed a jazz band",
        "while cooking on a stove that's actually a friendly dragon"
      ],
      
      exercise: [
        "but the gym equipment is made of marshmallows",
        "except you're working out underwater with fish as personal trainers",
        "while wearing a cape that makes you bounce like a kangaroo"
      ],
      
      meeting: [
        "but everyone communicates only through interpretive dance",
        "except the conference room is inside a giant snow globe",
        "while sitting on throne chairs made of office supplies"
      ],
      
      commute: [
        "but your transport is a giant flying taco",
        "except the route goes through a tunnel made of books",
        "while being serenaded by a choir of traffic cones"
      ],

      default: [
        "but gravity works sideways and everyone walks on walls",
        "except everything is made of jelly and wobbles when touched",
        "while being followed by a parade of tiny elephants playing trumpets"
      ]
    };

    // Dream rating system
    function calculateDreamRating(userInput, scenarios) {
      const inputWords = userInput.toLowerCase().split(/\s+/);
      
      // Keywords that make dreams more absurd
      const absurdKeywords = ['work', 'office', 'boss', 'meeting', 'traffic', 'coffee', 'shopping', 'exercise', 'cooking', 'commute', 'study', 'exam', 'presentation', 'deadline', 'stress'];
      const creativityKeywords = ['creative', 'art', 'music', 'dance', 'paint', 'write', 'imagine', 'dream'];
      const boringKeywords = ['boring', 'tired', 'routine', 'same', 'usual', 'normal', 'regular'];
      
      let score = 50; // Base score
      
      // Add points for mundane activities (more absurd potential)
      absurdKeywords.forEach(keyword => {
        if (inputWords.some(word => word.includes(keyword))) {
          score += 15;
        }
      });
      
      // Add points for creative activities
      creativityKeywords.forEach(keyword => {
        if (inputWords.some(word => word.includes(keyword))) {
          score += 10;
        }
      });
      
      // Add points for boring activities (high absurd potential)
      boringKeywords.forEach(keyword => {
        if (inputWords.some(word => word.includes(keyword))) {
          score += 20;
        }
      });
      
      // Length bonus (more details = more absurd potential)
      if (userInput.length > 100) score += 10;
      if (userInput.length > 200) score += 10;
      
      // Random factor for uniqueness
      score += Math.floor(Math.random() * 15);
      
      // Cap the score
      score = Math.min(100, Math.max(10, score));
      
      const ratings = [
        { min: 90, label: "ðŸŒŸ LEGENDARY ABSURDITY - Pure Dream Magic!", color: "#FFD700" },
        { min: 80, label: "ðŸŽ­ WONDERFULLY WEIRD - Epic Dream Material!", color: "#FF6B6B" },
        { min: 70, label: "âœ¨ CHARMINGLY ABSURD - Sweet Dream Vibes!", color: "#4ECDC4" },
        { min: 60, label: "ðŸŒ™ MILDLY MAGICAL - Gentle Fantasy!", color: "#45B7D1" },
        { min: 40, label: "ðŸ˜´ COZY WEIRDNESS - Peaceful Absurdity!", color: "#96CEB4" },
        { min: 0, label: "ðŸŒ¸ SUBTLE STRANGENESS - Soft Dream Whispers!", color: "#FFEAA7" }
      ];
      
      const rating = ratings.find(r => score >= r.min);
      return { score, label: rating.label, color: rating.color };
    }

    function getAbsurdScenarios(userInput) {
      const inputLower = userInput.toLowerCase();
      let scenarios = ABSURD_SCENARIOS.default;
      
      // Detect activity type and use appropriate scenarios
      for (let [activity, absurdList] of Object.entries(ABSURD_SCENARIOS)) {
        if (activity !== 'default' && inputLower.includes(activity)) {
          scenarios = absurdList;
          break;
        }
      }
      
      // Create 3 absurd scenes
      const shuffled = [...scenarios].sort(() => 0.5 - Math.random());
      return [
        `Imagine ${userInput} ${shuffled[0]}`,
        `Picture this: ${userInput} ${shuffled[1]}`, 
        `Dream finale: ${userInput} ${shuffled[2]}`
      ];
    }

    async function absurdify() {
      const day = document.getElementById('day').value;
      
      if (!day) {
        return alert("Enter your day first! âœ¨");
      }
      
      if (!HUGGINGFACE_KEY || HUGGINGFACE_KEY === "YOUR_HF_API_KEY") {
        return alert("Please add your Hugging Face API key first!");
      }

      // Get contextual absurd scenarios
      const absurdScenes = getAbsurdScenarios(day);
      
      // Calculate dream rating
      const dreamRating = calculateDreamRating(day, absurdScenes);

      const button = document.querySelector('button');
      const originalText = button.innerHTML;
      button.innerHTML = '<span class="loading">Creating your dream</span>';
      button.disabled = true;

      document.getElementById('output').innerHTML = '<div class="swiper-slide"><div style="text-align: center; padding: 60px;"><p style="font-size: 18px;">Loading your absurd dream... âœ¨</p></div></div>';

      let slides = "";
      
      for (let i = 0; i < absurdScenes.length; i++) {
        const scene = absurdScenes[i];
        try {
          const imgUrl = await getImage(scene + ", surreal digital art, vibrant colors, dreamlike atmosphere");
          slides += `
            <div class="swiper-slide">
              <img class="slide-img" src="${imgUrl}" alt="${scene}" />
              <div class="caption">${scene}</div>
            </div>
          `;
        } catch (error) {
          console.error('Image generation failed:', error);
          slides += `
            <div class="swiper-slide">
              <div style="text-align: center; padding: 40px;">
                <h3 style="margin-bottom: 20px;">${scene}</h3>
                <p style="opacity: 0.7;">âœ¨ Imagine this scene in your mind's eye âœ¨</p>
              </div>
            </div>
          `;
        }
      }
      
      // Add dream rating slide
      slides += `
        <div class="swiper-slide">
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 72px; margin-bottom: 20px; color: ${dreamRating.color};">${dreamRating.score}%</div>
            <h3 style="margin-bottom: 15px; color: ${dreamRating.color};">ABSURDITY RATING</h3>
            <p style="font-size: 18px; line-height: 1.6;">${dreamRating.label}</p>
            <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
              <p style="opacity: 0.9; font-size: 14px;">Your daily moment has been transformed into ${dreamRating.score}% pure dream magic! ðŸŒŸ</p>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('output').innerHTML = slides;
      initSwiper();
      
      button.innerHTML = originalText;
      button.disabled = false;
    }

    async function getImage(prompt) {
      // Using the same model as your working version
      const res = await fetch("https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${HUGGINGFACE_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          inputs: prompt,
          options: { wait_for_model: true }
        })
      });

      if (!res.ok) {
        const errorData = await res.text();
        throw new Error(`API Error: ${res.status} - ${errorData}`);
      }

      const imageBlob = await res.blob();
      const imageUrl = URL.createObjectURL(imageBlob);
      return imageUrl;
    }

    // Initialize empty swiper on page load
    document.addEventListener('DOMContentLoaded', () => {
      initSwiper();
    });
  </script>
</body>
</html>